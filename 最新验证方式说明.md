# 验证方式变更说明 - 最新版本

## 概述

项目已将 JWT Token 验证全部替换为账号密码验证机制，所有接口均采用统一的验证方式。

## 主要变更

### 1. app.js

- 注释掉了 JWT 相关导入和中间件
- 移除了 Basic Auth 验证中间件
- 所有路由直接使用，验证逻辑在各自接口中处理

### 2. router-handler/user.js

- 注释掉了 JWT 相关导入
- 登录接口不再生成和返回 token
- 登录成功后直接返回用户信息

### 3. router-handler/userInfo.js

- 添加了 bcrypt 导入用于密码验证
- `getUserInfo` 和 `updateUserInfo` 接口改为从请求体获取账号密码
- 验证方式与登录注册接口完全一致

## 新的验证机制

### 前端调用方式

所有需要身份验证的接口都通过请求体传递账号密码，与登录注册接口保持一致：

```javascript
// 登录
fetch("/api/login", {
  method: "POST",
  headers: {
    "Content-Type": "application/x-www-form-urlencoded",
  },
  body: "username=testuser&password=testpass",
});

// 获取用户信息
fetch("/my/userInfo", {
  method: "POST", // 改为POST请求
  headers: {
    "Content-Type": "application/x-www-form-urlencoded",
  },
  body: "username=testuser&password=testpass",
});

// 更新用户信息
fetch("/my/userInfo", {
  method: "POST",
  headers: {
    "Content-Type": "application/x-www-form-urlencoded",
  },
  body: "username=testuser&password=testpass&newUsername=newname&age=25&phone=1234567890&email=test@example.com",
});
```

### API 端点

- `/api/register` - 用户注册（POST 请求体：username, password）
- `/api/login` - 用户登录（POST 请求体：username, password）
- `/my/userInfo` - 获取用户信息（POST 请求体：username, password）
- `/my/userInfo` (POST) - 更新用户信息（POST 请求体：username, password, newUsername, age, phone, email）

### 请求体参数说明

#### 获取用户信息

- `username`: 当前用户名（必填）
- `password`: 当前密码（必填）

#### 更新用户信息

- `username`: 当前用户名（必填，用于验证身份）
- `password`: 当前密码（必填，用于验证身份）
- `newUsername`: 新用户名（可选，不填则保持原用户名）
- `age`: 年龄（可选）
- `phone`: 电话（可选）
- `email`: 邮箱（可选）

### 安全考虑

1. 每次请求都需要提供账号密码进行验证
2. 密码在数据库中使用 bcrypt 加密存储
3. 所有验证逻辑与登录接口保持一致
4. 建议在生产环境中使用 HTTPS 保护传输安全

## 测试示例

### 使用 curl 测试

```bash
# 登录
curl -X POST http://localhost:8080/api/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=testuser&password=testpass"

# 获取用户信息
curl -X POST http://localhost:8080/my/userInfo \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=testuser&password=testpass"

# 更新用户信息
curl -X POST http://localhost:8080/my/userInfo \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=testuser&password=testpass&newUsername=newname&age=25&phone=1234567890&email=test@example.com"
```

## 注意事项

1. 所有接口都使用 POST 请求，通过请求体传递参数
2. 请求头需要设置 `Content-Type: application/x-www-form-urlencoded`
3. 用户信息接口的验证方式与登录注册接口完全一致
4. 更新用户信息时，`username`和`password`用于身份验证，`newUsername`等字段用于更新信息
5. 密码验证失败会返回 401 状态码
